<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ocean Dynamics Test - Whispers of the Wave</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/splash.css">
    <style>
        body {
            padding: 2rem;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }

        .test-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .test-header h1 {
            color: #80deea;
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .test-section {
            background: rgba(10, 75, 94, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(128, 222, 234, 0.3);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .test-section h2 {
            color: #7dd3c0;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .state-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .state-btn {
            padding: 1rem 1.5rem;
            background: rgba(128, 222, 234, 0.2);
            border: 2px solid rgba(128, 222, 234, 0.4);
            border-radius: 15px;
            color: #80deea;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .state-btn:hover {
            background: rgba(128, 222, 234, 0.3);
            border-color: #7dd3c0;
            transform: translateY(-2px);
        }

        .state-btn.active {
            background: rgba(125, 211, 192, 0.4);
            border-color: #7dd3c0;
        }

        .test-messages {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .test-message-btn {
            padding: 1rem;
            background: rgba(10, 75, 94, 0.4);
            border: 1px solid rgba(128, 222, 234, 0.3);
            border-radius: 12px;
            color: #b3e5fc;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            font-size: 0.95rem;
        }

        .test-message-btn:hover {
            background: rgba(10, 75, 94, 0.6);
            border-color: rgba(128, 222, 234, 0.5);
            transform: translateX(5px);
        }

        .current-state-info {
            background: rgba(125, 211, 192, 0.15);
            border: 2px solid rgba(125, 211, 192, 0.4);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .state-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .state-info-item {
            text-align: center;
        }

        .state-info-label {
            color: #7dd3c0;
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .state-info-value {
            color: #e0f7fa;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 0.75rem 1.5rem;
            background: rgba(79, 195, 247, 0.2);
            border: 2px solid rgba(79, 195, 247, 0.4);
            border-radius: 12px;
            color: #4fc3f7;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .control-btn:hover {
            background: rgba(79, 195, 247, 0.3);
            border-color: #4fc3f7;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: rgba(10, 75, 94, 0.4);
            border-radius: 15px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4fc3f7, #7dd3c0);
            transition: width 1s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0a1128;
            font-weight: 600;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <!-- Ocean background -->
    <div class="ocean-background"></div>

    <div class="test-container">
        <div class="test-header">
            <h1>üåä Ocean Dynamics Test</h1>
            <p style="color: #b3e5fc; font-size: 1.1rem;">Prueba el sistema de oleaje din√°mico</p>
        </div>

        <!-- Current State Info -->
        <div class="current-state-info">
            <h3 style="color: #7dd3c0; margin-bottom: 1rem; text-align: center;">Estado Actual</h3>
            <div class="state-info-grid">
                <div class="state-info-item">
                    <div class="state-info-label">Estado</div>
                    <div class="state-info-value" id="currentStateName">Neutral</div>
                </div>
                <div class="state-info-item">
                    <div class="state-info-label">Velocidad</div>
                    <div class="state-info-value" id="currentStateSpeed">15s</div>
                </div>
                <div class="state-info-item">
                    <div class="state-info-label">Intensidad</div>
                    <div class="state-info-value" id="currentStateIntensity">Medium</div>
                </div>
                <div class="state-info-item">
                    <div class="state-info-label">Progreso</div>
                    <div class="state-info-value" id="currentStateProgress">40%</div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 40%">40%</div>
            </div>
        </div>

        <!-- Manual State Selection -->
        <div class="test-section">
            <h2>üé® Selecci√≥n Manual de Estado</h2>
            <div class="state-buttons" id="stateButtons"></div>
        </div>

        <!-- Test Messages -->
        <div class="test-section">
            <h2>üí¨ Mensajes de Prueba</h2>
            <p style="color: #b3e5fc; margin-bottom: 1rem;">Click en un mensaje para simular su an√°lisis</p>
            <div class="test-messages" id="testMessages"></div>
        </div>

        <!-- Controls -->
        <div class="test-section">
            <h2>‚öôÔ∏è Controles</h2>
            <div class="controls">
                <button class="control-btn" onclick="resetOcean()">üîÑ Reset a Neutral</button>
                <button class="control-btn" onclick="toggleTheme()">üåì Cambiar Tema</button>
                <button class="control-btn" onclick="toggleIndicator()">üëÅÔ∏è Toggle Indicador</button>
                <button class="control-btn" onclick="simulateConversation()">üé≠ Simular Conversaci√≥n</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../js/engine/oceanDynamics.js"></script>
    <script src="../js/ui/oceanStateUI.js"></script>

    <script>
        // Test messages for each state
        const testMessages = {
            confused: [
                "No s√© qu√© hacer con mi vida",
                "Estoy perdido y no entiendo nada",
                "Todo es tan confuso, no s√© por d√≥nde empezar"
            ],
            anxious: [
                "Estoy muy preocupado por el futuro",
                "Tengo miedo de que todo salga mal",
                "La ansiedad no me deja dormir"
            ],
            processing: [
                "¬øPor qu√© me siento as√≠?",
                "Quiz√°s deber√≠a intentar algo diferente",
                "¬øC√≥mo puedo mejorar esta situaci√≥n?"
            ],
            clarity: [
                "Ahora entiendo lo que me pasa",
                "Veo m√°s claro el camino a seguir",
                "Comprendo mejor mis emociones"
            ],
            resolved: [
                "Gracias, me siento mucho mejor",
                "He encontrado paz con esto",
                "Esto me ha ayudado a resolver mis dudas"
            ]
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderStateButtons();
            renderTestMessages();
            updateStateInfo();

            // Listen for state changes
            document.addEventListener('ocean:stateChanged', (e) => {
                updateStateInfo();
                highlightActiveState(e.detail.state);
            });
        });

        // Render state buttons
        function renderStateButtons() {
            const container = document.getElementById('stateButtons');
            const states = OceanDynamics.states;

            Object.keys(states).forEach(stateId => {
                const state = states[stateId];
                const btn = document.createElement('button');
                btn.className = 'state-btn';
                btn.dataset.stateId = stateId;
                btn.innerHTML = `
                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">${getStateEmoji(stateId)}</div>
                    <div>${state.name}</div>
                `;
                btn.onclick = () => OceanDynamics.forceState(stateId);
                container.appendChild(btn);
            });
        }

        // Render test messages
        function renderTestMessages() {
            const container = document.getElementById('testMessages');

            Object.keys(testMessages).forEach(stateId => {
                const messages = testMessages[stateId];
                const state = OceanDynamics.states[stateId];

                messages.forEach(message => {
                    const btn = document.createElement('button');
                    btn.className = 'test-message-btn';
                    btn.innerHTML = `
                        <div style="color: #7dd3c0; font-size: 0.8rem; margin-bottom: 0.3rem;">
                            ${getStateEmoji(stateId)} ${state.name}
                        </div>
                        <div>"${message}"</div>
                    `;
                    btn.onclick = () => {
                        const detectedState = OceanDynamics.analyzeEmotionalState(message);
                        console.log('Detected state:', detectedState, 'for message:', message);
                        OceanDynamics.setState(detectedState);
                    };
                    container.appendChild(btn);
                });
            });
        }

        // Update state info display
        function updateStateInfo() {
            const state = OceanDynamics.getCurrentState();
            document.getElementById('currentStateName').textContent = state.name;
            document.getElementById('currentStateSpeed').textContent = state.speed + 's';
            document.getElementById('currentStateIntensity').textContent = state.intensity;
            
            const progress = OceanDynamics.getProgressionPercentage(state.id);
            document.getElementById('currentStateProgress').textContent = progress + '%';
            
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = progress + '%';
            progressBar.textContent = progress + '%';
        }

        // Highlight active state button
        function highlightActiveState(stateId) {
            document.querySelectorAll('.state-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.stateId === stateId);
            });
        }

        // Get emoji for state
        function getStateEmoji(stateId) {
            const emojis = {
                confused: 'üòï',
                anxious: 'üò∞',
                processing: 'ü§î',
                clarity: 'üí°',
                resolved: '‚ú®',
                neutral: 'üåä'
            };
            return emojis[stateId] || 'üåä';
        }

        // Control functions
        function resetOcean() {
            OceanDynamics.reset();
        }

        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.dataset.theme || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            body.dataset.theme = newTheme;
            
            document.dispatchEvent(new CustomEvent('theme:changed', {
                detail: { theme: newTheme }
            }));
        }

        function toggleIndicator() {
            OceanStateUI.toggle();
        }

        function simulateConversation() {
            const sequence = ['confused', 'anxious', 'processing', 'clarity', 'resolved'];
            let index = 0;

            const interval = setInterval(() => {
                if (index >= sequence.length) {
                    clearInterval(interval);
                    return;
                }

                OceanDynamics.setState(sequence[index]);
                index++;
            }, 3000);
        }
    </script>
</body>
</html>
