<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whispers of the Wave üåä - Spec System Demo</title>
    <link rel="stylesheet" href="css/style.css">
    
    <style>
        /* Spec indicator styles - more compact */
        .spec-indicator {
            position: fixed;
            top: 0.75rem;
            right: 0.75rem;
            background: rgba(10, 17, 40, 0.85);
            backdrop-filter: blur(12px);
            padding: 0.6rem 1rem;
            border-radius: 1.5rem;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
            gap: 0.4rem;
            z-index: 1000;
            transition: all 0.3s ease;
            border: 1px solid rgba(150, 220, 255, 0.3);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .spec-indicator:hover {
            background: rgba(10, 17, 40, 0.95);
            border-color: rgba(150, 220, 255, 0.5);
            transform: translateY(-1px);
        }
        
        .spec-icon {
            font-size: 1.1rem;
        }
        
        .spec-name {
            font-weight: 500;
            font-size: 0.85rem;
        }
        
        .spec-confidence {
            font-size: 0.7rem;
            opacity: 0.75;
            margin-left: 0.3rem;
        }
        
        .debug-panel {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background: rgba(0, 0, 0, 0.9);
            color: #0f0;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-family: 'Courier New', monospace;
            font-size: 0.7rem;
            max-width: 280px;
            max-height: 180px;
            overflow-y: auto;
            z-index: 999;
            display: none;
            border: 1px solid rgba(0, 255, 0, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }
        
        .debug-panel.active {
            display: block;
        }
        
        .debug-toggle {
            position: fixed;
            bottom: 0.75rem;
            left: 0.75rem;
            background: rgba(10, 17, 40, 0.85);
            color: white;
            border: 1px solid rgba(150, 220, 255, 0.3);
            padding: 0.5rem 0.9rem;
            border-radius: 1.5rem;
            cursor: pointer;
            z-index: 1000;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(12px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .debug-toggle:hover {
            background: rgba(10, 17, 40, 0.95);
            border-color: rgba(150, 220, 255, 0.5);
            transform: translateY(-1px);
        }
        
        /* TTS Toggle button styling */
        #ttsToggle {
            left: auto;
            right: 0.75rem;
            bottom: 3.5rem;
        }
        
        /* Suggested questions styles */
        .suggested-questions {
            margin: 1.5rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .suggested-questions-title {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.75rem;
            font-style: italic;
        }
        
        .question-wave {
            display: inline-block;
            margin: 0.4rem 0.3rem;
            padding: 0.6rem 1rem;
            background: linear-gradient(135deg, rgba(100, 200, 255, 0.15), rgba(150, 220, 255, 0.1));
            border: 1px solid rgba(150, 220, 255, 0.3);
            border-radius: 2rem;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .question-wave:hover {
            background: linear-gradient(135deg, rgba(100, 200, 255, 0.25), rgba(150, 220, 255, 0.2));
            border-color: rgba(150, 220, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(100, 200, 255, 0.2);
        }
        
        .question-wave:active {
            transform: translateY(0);
        }
        
        /* Container adjustments for better spacing */
        .container {
            width: 90%;
            max-width: 900px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        
        /* Mode indicator - more compact */
        .mode-indicator {
            flex-shrink: 0;
            padding: 0.6rem 1.25rem;
            margin-bottom: 0;
        }
        
        /* Fixed suggested questions at top */
        .suggested-questions-fixed {
            position: relative;
            flex-shrink: 0;
            padding: 0.875rem 1rem;
            background: rgba(10, 75, 94, 0.75);
            border-radius: 1rem;
            border: 1px solid rgba(150, 220, 255, 0.35);
            backdrop-filter: blur(12px);
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.25);
            max-height: 160px;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .suggested-questions-fixed::-webkit-scrollbar {
            width: 5px;
        }
        
        .suggested-questions-fixed::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .suggested-questions-fixed::-webkit-scrollbar-thumb {
            background: rgba(150, 220, 255, 0.3);
            border-radius: 10px;
        }
        
        .suggested-questions-fixed::-webkit-scrollbar-thumb:hover {
            background: rgba(150, 220, 255, 0.5);
        }
        
        /* Hide when no questions */
        .suggested-questions-fixed:empty {
            display: none;
            margin: 0;
            padding: 0;
        }
        
        /* Adjust message display to work with fixed questions */
        .message-display {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 1.25rem 1.5rem;
            margin: 0;
            scroll-behavior: smooth;
            min-height: 0;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .message-display::-webkit-scrollbar {
            width: 6px;
        }
        
        .message-display::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .message-display::-webkit-scrollbar-thumb {
            background: rgba(135, 206, 235, 0.3);
            border-radius: 10px;
        }
        
        .message-display::-webkit-scrollbar-thumb:hover {
            background: rgba(135, 206, 235, 0.5);
        }
        
        /* Input container - more compact */
        .input-container {
            flex-shrink: 0;
            padding: 0.75rem 1rem 1rem 1rem;
            margin: 0;
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }
        
        /* Send button */
        .send-button {
            flex-shrink: 0;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(100, 200, 255, 0.3), rgba(64, 224, 208, 0.3));
            border: 2px solid rgba(128, 222, 234, 0.5);
            color: #ffffff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .send-button:hover {
            background: linear-gradient(135deg, rgba(100, 200, 255, 0.5), rgba(64, 224, 208, 0.5));
            border-color: rgba(128, 222, 234, 0.8);
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(128, 222, 234, 0.4);
        }
        
        .send-button:active {
            transform: scale(0.95);
        }
        
        .send-button svg {
            width: 20px;
            height: 20px;
        }
        
        /* Welcome message - more compact */
        .welcome-message {
            margin-top: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 1.25rem;
        }
        
        /* Question waves - better spacing */
        .question-wave {
            display: inline-block;
            margin: 0.3rem 0.25rem;
            padding: 0.55rem 1rem;
            font-size: 0.875rem;
        }
        
        /* Suggested questions title */
        .suggested-questions-title {
            font-size: 0.8rem;
            color: rgba(150, 220, 255, 0.85);
            margin-bottom: 0.6rem;
            font-style: italic;
            text-align: center;
        }
        
        /* Mobile adjustments */
        @media (max-width: 768px) {
            .container {
                width: 95%;
                height: 95vh;
                gap: 0.5rem;
            }
            
            .mode-indicator {
                padding: 0.5rem 1rem;
            }
            
            .suggested-questions-fixed {
                padding: 0.65rem 0.75rem;
                max-height: 130px;
            }
            
            .message-display {
                padding: 1rem;
            }
            
            .input-container {
                padding: 0.5rem 0.75rem 0.75rem 0.75rem;
                gap: 0.5rem;
            }
            
            .send-button {
                width: 44px;
                height: 44px;
            }
            
            .send-button svg {
                width: 18px;
                height: 18px;
            }
            
            .question-wave {
                font-size: 0.8rem;
                padding: 0.45rem 0.85rem;
                margin: 0.25rem 0.2rem;
            }
            
            .suggested-questions-title {
                font-size: 0.75rem;
                margin-bottom: 0.5rem;
            }
            
            .welcome-message {
                padding: 1rem;
                margin-bottom: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                gap: 0.4rem;
            }
            
            .suggested-questions-fixed {
                padding: 0.6rem;
                max-height: 120px;
            }
            
            .question-wave {
                font-size: 0.75rem;
                padding: 0.4rem 0.75rem;
            }
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            top: 5rem;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            font-size: 0.9rem;
            z-index: 10000;
            opacity: 0;
            transform: translateX(400px);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            max-width: 350px;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification-success {
            background: rgba(100, 200, 100, 0.9);
            border: 1px solid rgba(100, 255, 100, 0.5);
        }
        
        .notification-warning {
            background: rgba(255, 200, 100, 0.9);
            border: 1px solid rgba(255, 220, 100, 0.5);
        }
        
        .notification-error {
            background: rgba(255, 100, 100, 0.9);
            border: 1px solid rgba(255, 150, 150, 0.5);
        }
        
        .notification-info {
            background: rgba(100, 150, 255, 0.9);
            border: 1px solid rgba(150, 200, 255, 0.5);
        }
        
        @media (max-width: 768px) {
            .notification {
                top: 4rem;
                right: 0.5rem;
                left: 0.5rem;
                max-width: none;
            }
        }
        
        /* Keyboard Shortcuts Help Modal */
        .shortcuts-help-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }
        
        .shortcuts-help-modal {
            background: rgba(10, 17, 40, 0.95);
            border: 1px solid rgba(150, 220, 255, 0.4);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }
        
        .shortcuts-help-modal h3 {
            color: rgba(150, 220, 255, 0.95);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            text-align: center;
        }
        
        .shortcuts-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
        }
        
        .shortcut-item kbd {
            background: rgba(100, 200, 255, 0.2);
            border: 1px solid rgba(100, 200, 255, 0.4);
            padding: 0.3rem 0.6rem;
            border-radius: 0.3rem;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: rgba(200, 240, 255, 0.95);
        }
        
        .shortcut-item span {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
        }
        
        .close-help-btn {
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(135deg, rgba(100, 200, 255, 0.3), rgba(64, 224, 208, 0.3));
            border: 1px solid rgba(128, 222, 234, 0.5);
            border-radius: 0.5rem;
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .close-help-btn:hover {
            background: linear-gradient(135deg, rgba(100, 200, 255, 0.5), rgba(64, 224, 208, 0.5));
            border-color: rgba(128, 222, 234, 0.8);
        }
    </style>
</head>
<body>
    <!-- Spec Indicator -->
    <div class="spec-indicator" id="specIndicator">
        <span class="spec-icon">üåä</span>
        <span class="spec-name">Initializing...</span>
        <span class="spec-confidence"></span>
    </div>

    <!-- Export Button -->
    <button class="debug-toggle" onclick="exportConversation()" id="exportBtn" style="left: auto; right: 0.75rem; bottom: 6rem;" title="Exportar conversaci√≥n">
        üíæ Exportar
    </button>
    
    <!-- TTS Toggle -->
    <button class="debug-toggle" onclick="toggleTTS()" id="ttsToggle" style="left: auto; right: 0.75rem; bottom: 3.5rem;" title="Activar/desactivar botones de audio en mensajes">
        üîá Voz OFF
    </button>

    <!-- Debug Toggle -->
    <button class="debug-toggle" onclick="toggleDebug()">üêõ Debug</button>
    
    <!-- Debug Panel -->
    <div class="debug-panel" id="debugPanel">
        <div id="debugContent">Waiting for messages...</div>
    </div>

    <!-- Animated ocean background -->
    <div class="ocean-background"></div>
    
    <!-- Main container -->
    <div class="container">
        <!-- Mode indicator -->
        <div id="modeIndicator" class="mode-indicator">
            <span class="mode-icon">üåä</span>
            <span id="modeText" class="mode-text">El Guardi√°n de la Ola</span>
        </div>
        
        <!-- Suggested Questions (Fixed at top) -->
        <div class="suggested-questions-fixed" id="suggestedQuestions">
            <div class="suggested-questions-title">üí≠ Olas de inspiraci√≥n - Prueba estos mensajes:</div>
            <div id="questionWaves"></div>
        </div>
        
        <!-- Message display -->
        <div id="messageDisplay" class="message-display">
            <div class="welcome-message">
                <p class="whisper">üåä Bienvenido al oc√©ano de pensamientos...</p>
                <p class="wave-reflection">
                    Soy <strong>El Guardi√°n de la Ola</strong> con sistema de routing inteligente.
                    <br><br>
                    Tus mensajes se enrutan autom√°ticamente:
                    <br>‚Ä¢ <strong>Emocionales</strong> ‚Üí Whispers üåä (po√©tico)
                    <br>‚Ä¢ <strong>Decisiones</strong> ‚Üí Kiro üß≠ (anal√≠tico)
                    <br><br>
                    Comparte lo que llevas dentro...
                </p>
            </div>
        </div>
        
        <!-- Input container -->
        <div class="input-container">
            <input 
                type="text" 
                id="userInput" 
                class="user-input" 
                placeholder="Escribe tu mensaje aqu√≠..." 
                autocomplete="off"
            />
            <button id="sendButton" class="send-button" title="Enviar mensaje (Enter)">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>
    </div>

    <!-- Configuration (must load first) -->
    <script src="js/config.local.js"></script>
    
    <!-- Conversation History -->
    <script src="js/core/conversationHistory.js"></script>
    
    <!-- Prompts (centralized) -->
    <script src="js/prompts/system_prompts.js"></script>
    
    <!-- Features -->
    <script src="js/features/keyboardShortcuts.js"></script>
    
    <!-- Core Dependencies -->
    <script src="js/core/state.js"></script>
    <script src="js/core/appFacade.js"></script>
    
    <!-- Services -->
    <script src="js/services/geminiService.js"></script>
    
    <!-- UI Modules -->
    <script src="js/ui/renderer.js"></script>
    
    <!-- Engine Modules -->
    <script src="js/engine/emotional.js"></script>
    <script src="js/engine/parser.js"></script>
    
    <!-- Inline Spec System Data (Browser Compatible) -->
    <script>
        // Registry data (inline for browser)
        window.SPEC_REGISTRY = [
            {
                "id": "whispers-of-the-wave",
                "title": "Whispers of the Wave",
                "status": "active",
                "description": "Emotional and introspective conversations"
            },
            {
                "id": "kiro-adaptive-assistance",
                "title": "Kiro Adaptive Assistance",
                "status": "active",
                "description": "Decision-making and planning support"
            }
        ];

        // Rules data (inline for browser)
        window.SPEC_RULES = {
            "whispers-of-the-wave": {
                "keywords": ["siento", "sentir", "emoci√≥n", "emocional", "solo", "soledad", "triste", "tristeza", "perdido", "perdida", "vida", "existencia", "sentido", "prop√≥sito", "vac√≠o", "vac√≠a", "coraz√≥n", "alma", "dolor", "sufrimiento", "miedo", "ansiedad", "angustia", "confundido", "confundida", "reflexi√≥n", "reflexionar", "pensar", "pensamiento", "profundo", "profunda", "introspecci√≥n", "meditar", "meditaci√≥n", "paz", "calma", "serenidad", "oc√©ano", "ola", "mar", "agua", "fluir"],
                "intents": ["emotional_support", "life_questioning", "existential_reflection", "seeking_peace", "processing_emotions", "introspection", "poetic_expression", "philosophical_inquiry"],
                "patterns": {
                    "emotional_low": ["me siento", "estoy triste", "no puedo", "ya no", "sin sentido"],
                    "life_questioning": ["qu√© hago", "para qu√©", "por qu√©", "cu√°l es el sentido", "no s√© qu√© hacer"],
                    "seeking_comfort": ["necesito", "ayuda", "solo", "nadie", "acompa√±ar"]
                },
                "weight": 1.0,
                "tone": "empathetic",
                "response_style": "poetic"
            },
            "kiro-adaptive-assistance": {
                "keywords": ["decidir", "decisi√≥n", "elegir", "elecci√≥n", "opci√≥n", "opciones", "alternativa", "alternativas", "qu√© hacer", "c√≥mo hacer", "plan", "planear", "estrategia", "acci√≥n", "paso", "pasos", "objetivo", "meta", "lograr", "conseguir", "alcanzar", "problema", "soluci√≥n", "resolver", "enfrentar", "situaci√≥n", "dilema", "conflicto", "prioridad", "priorizar", "organizar", "estructura", "m√©todo", "proceso", "evaluar", "evaluaci√≥n", "analizar", "an√°lisis", "comparar", "comparaci√≥n", "pros", "contras", "ventajas", "desventajas", "estudiar", "carrera", "profesional", "orientaci√≥n", "orientacion", "ayuda", "ay√∫dame", "ayudame", "gu√≠a", "guia", "consejo", "recomendar", "recomendaci√≥n", "recomendacion", "deber√≠a", "deberia", "mejor", "peor", "entre", "dise√±o", "programaci√≥n", "programacion", "trabajo", "empleo", "proyecto"],
                "intents": ["decision_support", "action_planning", "problem_solving", "goal_setting", "priority_management", "strategic_thinking", "evaluation_request", "clarity_seeking", "direction_needed"],
                "patterns": {
                    "decision_making": ["tengo que elegir", "no s√© qu√© decidir", "entre dos", "cu√°l es mejor", "deber√≠a", "qu√© deber√≠a", "ay√∫dame a decidir", "ayudame a decidir", "entre", "o programaci√≥n", "o dise√±o"],
                    "action_planning": ["c√≥mo empiezo", "qu√© pasos", "plan de acci√≥n", "por d√≥nde empezar", "necesito un plan"],
                    "problem_solving": ["tengo un problema", "c√≥mo resuelvo", "qu√© hago con", "enfrentar", "solucionar"],
                    "clarity_seeking": ["no entiendo", "confuso", "aclarar", "explicar", "entender mejor"],
                    "career_guidance": ["qu√© estudiar", "que estudiar", "orientaci√≥n profesional", "orientacion profesional", "carrera", "trabajo"]
                },
                "weight": 1.0,
                "tone": "analytical",
                "response_style": "structured"
            },
            "_meta": {
                "version": "1.0.0",
                "default_spec": "whispers-of-the-wave",
                "confidence_thresholds": {
                    "high": 0.7,
                    "medium": 0.4,
                    "low": 0.4
                },
                "scoring_weights": {
                    "keywords": 0.40,
                    "intents": 0.40,
                    "context": 0.20
                }
            }
        };
    </script>
    
    <!-- Spec System (Browser Compatible Versions) -->
    <script src="js/browser/spec_interface.browser.js"></script>
    <script src="js/browser/router.browser.js"></script>
    <script src="js/browser/main_orchestrator.browser.js"></script>
    <script src="js/browser/whispers_adapter.browser.js"></script>
    <script src="js/browser/kiro_adapter.browser.js"></script>
    <script src="js/browser/spec_loader.browser.js"></script>
    <script src="js/browser/spec_integration.browser.js"></script>
    
    <!-- Main Application -->
    <script src="js/browser/main_demo.js"></script>
    
    <!-- Debug Functions -->
    <script>
        function toggleDebug() {
            const panel = document.getElementById('debugPanel');
            panel.classList.toggle('active');
        }
        
        async function toggleTTS() {
            if (window.DemoApp) {
                const button = document.getElementById('ttsToggle');
                
                // Show loading state
                if (button) {
                    button.textContent = '‚è≥ Verificando...';
                    button.disabled = true;
                }
                
                const newState = window.DemoApp.toggleTTS();
                
                // Wait a bit to verify TTS initialization
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const ttsState = window.DemoApp.getTTSState();
                
                if (button) {
                    if (newState && ttsState.initialized) {
                        // TTS successfully enabled
                        button.textContent = 'üîä Voz ON';
                        button.style.opacity = '1';
                        button.title = 'Voz activada - Las respuestas se reproducir√°n autom√°ticamente';
                        button.style.background = 'rgba(100, 200, 100, 0.3)';
                        
                        // Show success notification
                        showNotification('‚úÖ Voz activada correctamente', 'success');
                    } else if (newState && !ttsState.initialized) {
                        // TTS enabled but not initialized (API key issue)
                        button.textContent = '‚ö†Ô∏è Voz (Sin API)';
                        button.style.opacity = '0.7';
                        button.title = 'Voz activada pero falta configurar API key';
                        button.style.background = 'rgba(255, 200, 100, 0.3)';
                        
                        showNotification('‚ö†Ô∏è Voz activada pero necesitas configurar tu API key', 'warning');
                    } else {
                        // TTS disabled
                        button.textContent = 'üîá Voz OFF';
                        button.style.opacity = '0.5';
                        button.title = 'Voz desactivada - Click para activar';
                        button.style.background = '';
                        
                        showNotification('üîá Voz desactivada', 'info');
                    }
                    button.disabled = false;
                }
                
                updateDebug(`TTS ${newState ? 'enabled' : 'disabled'} (initialized: ${ttsState.initialized})`);
                
                // Show/hide audio buttons on existing messages
                const audioButtons = document.querySelectorAll('.audio-play-btn');
                audioButtons.forEach(btn => {
                    btn.style.display = newState ? 'inline-flex' : 'none';
                    
                    // Update button state if TTS not initialized
                    if (newState && !ttsState.initialized) {
                        btn.title = 'TTS no disponible - Configura tu API key';
                        btn.style.opacity = '0.5';
                    }
                });
            }
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => notification.classList.add('show'), 10);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        function updateDebug(message) {
            const content = document.getElementById('debugContent');
            const timestamp = new Date().toLocaleTimeString();
            content.innerHTML = `[${timestamp}] ${message}<br>` + content.innerHTML;
            
            // Keep only last 10 messages
            const lines = content.innerHTML.split('<br>');
            if (lines.length > 10) {
                content.innerHTML = lines.slice(0, 10).join('<br>');
            }
        }
        
        function updateSpecIndicator(specId, confidence) {
            const indicator = document.getElementById('specIndicator');
            const specNames = {
                'whispers-of-the-wave': { name: 'Whispers üåä', icon: 'üåä' },
                'kiro-adaptive-assistance': { name: 'Kiro üß≠', icon: 'üß≠' }
            };
            
            const spec = specNames[specId] || { name: 'Unknown', icon: '‚ùì' };
            
            const iconEl = indicator.querySelector('.spec-icon');
            const nameEl = indicator.querySelector('.spec-name');
            const confidenceEl = indicator.querySelector('.spec-confidence');
            
            if (iconEl) iconEl.textContent = spec.icon;
            if (nameEl) nameEl.textContent = spec.name;
            if (confidenceEl && confidence !== undefined) {
                confidenceEl.textContent = `${Math.round(confidence * 100)}%`;
            }
            
            updateDebug(`Spec: ${spec.name} | Confidence: ${Math.round(confidence * 100)}%`);
        }
        
        // Setup send button
        document.addEventListener('DOMContentLoaded', () => {
            const sendButton = document.getElementById('sendButton');
            const userInput = document.getElementById('userInput');
            
            if (sendButton && userInput) {
                sendButton.addEventListener('click', () => {
                    const message = userInput.value.trim();
                    if (message && window.DemoApp) {
                        window.DemoApp.sendMessage(message);
                        userInput.value = '';
                    }
                });
            }
        });
        
        // Export conversation function
        function exportConversation() {
            if (!window.ConversationHistory) {
                showNotification('‚ö†Ô∏è Historial no disponible', 'warning');
                return;
            }
            
            const format = prompt('Formato de exportaci√≥n:\n1. Markdown\n2. Texto\n3. JSON\n\nEscribe 1, 2 o 3:');
            
            let content, filename, mimeType;
            
            if (format === '1') {
                content = window.ConversationHistory.export('markdown');
                filename = `whispers-${Date.now()}.md`;
                mimeType = 'text/markdown';
            } else if (format === '2') {
                content = window.ConversationHistory.export('text');
                filename = `whispers-${Date.now()}.txt`;
                mimeType = 'text/plain';
            } else if (format === '3') {
                content = window.ConversationHistory.export('json');
                filename = `whispers-${Date.now()}.json`;
                mimeType = 'application/json';
            } else {
                showNotification('‚ùå Formato inv√°lido', 'error');
                return;
            }
            
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('‚úÖ Conversaci√≥n exportada', 'success');
        }
        
        console.log('üåä Whispers of the Wave - Spec System Demo');
        console.log('üí° Abre el panel de debug para ver el routing en tiempo real');
        console.log('üìä Prueba mensajes emocionales y de decisi√≥n para ver el routing');
        console.log('üíæ Usa el bot√≥n "Exportar" para guardar tus conversaciones');
    </script>
</body>
</html>
